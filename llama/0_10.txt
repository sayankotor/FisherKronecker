2025-04-27 01:30:44,353 - INFO - Loading model: unsloth/llama-2-7b-chat[2025-04-27 01:30:50,802] [INFO] [real_accelerator.py:222:get_accelerator] Setting ds_accelerator to cuda (auto detect)Warning: The cache directory for DeepSpeed Triton autotune, /home/jovyan/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.14it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.31it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:02<00:00,  1.56it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:02<00:00,  1.46it/s]2025-04-27 01:30:54,919 - INFO - Model loaded with dtype torch.bfloat162025-04-27 01:31:43,653 - INFO - Model moved to cuda:02025-04-27 01:31:43,656 - INFO - Total parameters before compression: 67384156162025-04-27 01:31:43,656 - INFO - Layer: model.layers.2.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 01:31:43,659 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_2_self_attn_q_proj.safetensors2025-04-27 01:31:43,659 - INFO - exists: True2025-04-27 01:31:43,662 - INFO - factorize_layer_kron_svd2025-04-27 01:31:45,073 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:31:46,217 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:31:47,341 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 01:31:48,455 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 01:31:49,561 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 01:31:50,815 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 01:31:52,098 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:31:53,263 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:31:54,388 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 01:31:55,557 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 01:31:56,733 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 01:31:58,461 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.2.self_attn.q_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_2_self_attn_q_proj.safetensors TrueLayer: model.layers.2.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [1.6124124e-05 1.1238000e-05 1.0046171e-05 9.5376463e-06 9.3023737e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 01:32:38,349 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 01:32:38,349 - INFO - Replacing 'model.layers.2.self_attn.q_proj' (attribute 'q_proj' within parent LlamaAttention)2025-04-27 01:32:38,349 - INFO - Compression finished. 2025-04-27 01:32:38,353 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:04<01:37,  4.87s/it]Evaluating:  10%|████                                      | 2/21 [00:06<00:51,  2.72s/it]Evaluating:  14%|██████                                    | 3/21 [00:07<00:36,  2.03s/it]Evaluating:  19%|████████                                  | 4/21 [00:08<00:29,  1.71s/it]Evaluating:  24%|██████████                                | 5/21 [00:09<00:24,  1.53s/it]Evaluating:  29%|████████████                              | 6/21 [00:10<00:21,  1.42s/it]Evaluating:  33%|██████████████                            | 7/21 [00:12<00:18,  1.35s/it]Evaluating:  38%|████████████████                          | 8/21 [00:13<00:17,  1.31s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:14<00:15,  1.28s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:15<00:13,  1.26s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:16<00:12,  1.24s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:18<00:11,  1.23s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:19<00:09,  1.23s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:20<00:08,  1.22s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:21<00:07,  1.22s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:23<00:06,  1.22s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:24<00:04,  1.22s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:25<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:26<00:02,  1.22s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:27<00:01,  1.22s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:28<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:28<00:00,  1.37s/it]2025-04-27 01:33:14,798 - INFO - wikitext2 perplexity: 6.93752025-04-27 01:33:14,799 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 01:33:25,594 - INFO - ptb perplexity: 25.37502025-04-27 01:33:25,594 - INFO - Evaluation results:2025-04-27 01:33:25,594 - INFO -   wikitext2: 6.93752025-04-27 01:33:25,594 - INFO -   ptb: 25.3750nlls.shape torch.Size([16376])Mean NLL: 3.234375Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.39it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.43it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.69it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.61it/s]2025-04-27 01:33:28,210 - INFO - Layer: model.layers.2.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 01:33:28,212 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_2_self_attn_k_proj.safetensors2025-04-27 01:33:28,212 - INFO - exists: True2025-04-27 01:33:28,216 - INFO - factorize_layer_kron_svd2025-04-27 01:33:29,298 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:33:30,498 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 01:33:31,534 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:33:32,743 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.2.self_attn.k_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_2_self_attn_k_proj.safetensors TrueLayer: model.layers.2.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [4.0046256e-03 1.5359199e-04 9.4199255e-05 5.9006747e-05 4.1726034e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 01:34:04,469 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 01:34:04,469 - INFO - Replacing 'model.layers.2.self_attn.k_proj' (attribute 'k_proj' within parent LlamaAttention)2025-04-27 01:34:04,475 - INFO - Compression finished. 2025-04-27 01:34:33,295 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:38,  1.91s/it]Evaluating:  10%|████                                      | 2/21 [00:03<00:28,  1.50s/it]Evaluating:  14%|██████                                    | 3/21 [00:04<00:24,  1.37s/it]Evaluating:  19%|████████                                  | 4/21 [00:05<00:22,  1.31s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:20,  1.27s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.25s/it]Evaluating:  33%|██████████████                            | 7/21 [00:09<00:17,  1.24s/it]Evaluating:  38%|████████████████                          | 8/21 [00:10<00:15,  1.23s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:11<00:14,  1.22s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.22s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:14<00:12,  1.22s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:15<00:10,  1.22s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:16<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:17<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:20<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:21<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:22<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.23s/it]2025-04-27 01:35:04,711 - INFO - wikitext2 perplexity: 6.93752025-04-27 01:35:04,712 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 01:35:14,992 - INFO - ptb perplexity: 25.37502025-04-27 01:35:14,992 - INFO - Evaluation results:2025-04-27 01:35:14,993 - INFO -   wikitext2: 6.93752025-04-27 01:35:14,993 - INFO -   ptb: 25.3750nlls.shape torch.Size([16376])Mean NLL: 3.234375Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.03it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.32it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.72it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.54it/s]2025-04-27 01:35:17,296 - INFO - Layer: model.layers.2.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 01:35:17,297 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_2_self_attn_v_proj.safetensors2025-04-27 01:35:17,297 - INFO - exists: True2025-04-27 01:35:17,302 - INFO - factorize_layer_kron_svd2025-04-27 01:35:18,512 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:35:20,329 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 01:35:21,492 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:35:23,163 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:35:24,916 - INFO -   Factor is positive definite (alpha=1.00e-03)model.layers.2.self_attn.v_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_2_self_attn_v_proj.safetensors TrueLayer: model.layers.2.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [8.2086452e-04 5.6584428e-05 2.0973550e-05 1.8921663e-05 9.9427562e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 01:36:05,281 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 01:36:05,281 - INFO - Replacing 'model.layers.2.self_attn.v_proj' (attribute 'v_proj' within parent LlamaAttention)2025-04-27 01:36:05,284 - INFO - Compression finished. 2025-04-27 01:36:12,544 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 01:36:42,487 - INFO - wikitext2 perplexity: 7.00002025-04-27 01:36:42,487 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 01:36:52,515 - INFO - ptb perplexity: 25.37502025-04-27 01:36:52,515 - INFO - Evaluation results:2025-04-27 01:36:52,515 - INFO -   wikitext2: 7.00002025-04-27 01:36:52,515 - INFO -   ptb: 25.3750nlls.shape torch.Size([16376])Mean NLL: 3.234375Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.52it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.35it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:02<00:00,  1.36it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:02<00:00,  1.38it/s]2025-04-27 01:36:55,124 - INFO - Layer: model.layers.2.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 01:36:55,124 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_2_self_attn_o_proj.safetensors2025-04-27 01:36:55,124 - INFO - exists: True2025-04-27 01:36:55,129 - INFO - factorize_layer_kron_svd2025-04-27 01:36:56,584 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:36:58,165 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:36:59,793 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 01:37:01,151 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:37:02,732 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.2.self_attn.o_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_2_self_attn_o_proj.safetensors TrueLayer: model.layers.2.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [9.5207366e-04 2.1441100e-04 2.5828673e-05 1.6485483e-05 1.3000157e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 01:37:39,938 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 01:37:39,938 - INFO - Replacing 'model.layers.2.self_attn.o_proj' (attribute 'o_proj' within parent LlamaAttention)2025-04-27 01:37:39,940 - INFO - Compression finished. 2025-04-27 01:37:46,169 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 01:38:16,674 - INFO - wikitext2 perplexity: 7.06252025-04-27 01:38:16,674 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.953125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 01:38:26,784 - INFO - ptb perplexity: 25.75002025-04-27 01:38:26,784 - INFO - Evaluation results:2025-04-27 01:38:26,784 - INFO -   wikitext2: 7.06252025-04-27 01:38:26,785 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.67it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.41it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:02<00:00,  1.37it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:02<00:00,  1.40it/s]2025-04-27 01:38:29,269 - INFO - Layer: model.layers.2.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 01:38:29,270 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_2_mlp_gate_proj.safetensors2025-04-27 01:38:29,270 - INFO - exists: True2025-04-27 01:38:29,274 - INFO - factorize_layer_kron_svd2025-04-27 01:38:30,448 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:38:31,582 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:38:32,696 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 01:38:33,807 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 01:38:34,918 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 01:38:36,559 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 01:38:38,231 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:38:40,164 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:38:42,049 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 01:38:44,042 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 01:38:46,208 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 01:38:50,720 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.2.mlp.gate_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_2_mlp_gate_proj.safetensors TrueLayer: model.layers.2.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [1.0536157e-05 7.8889116e-06 7.3416263e-06 6.9958951e-06 6.9346693e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 01:39:38,005 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 01:39:38,005 - INFO - Replacing 'model.layers.2.mlp.gate_proj' (attribute 'gate_proj' within parent LlamaMLP)2025-04-27 01:39:38,011 - INFO - Compression finished. 2025-04-27 01:39:45,346 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.22s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.22s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.22s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.22s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 01:40:15,356 - INFO - wikitext2 perplexity: 7.00002025-04-27 01:40:15,356 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.25s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.23s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.22s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.22s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.22s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.20s/it]2025-04-27 01:40:25,663 - INFO - ptb perplexity: 28.37502025-04-27 01:40:25,663 - INFO - Evaluation results:2025-04-27 01:40:25,663 - INFO -   wikitext2: 7.00002025-04-27 01:40:25,663 - INFO -   ptb: 28.3750nlls.shape torch.Size([16376])Mean NLL: 3.34375Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:01<00:02,  1.45s/it]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:02<00:01,  1.41s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:03<00:00,  1.19s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:03<00:00,  1.26s/it]2025-04-27 01:40:29,862 - INFO - Layer: model.layers.2.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 01:40:29,863 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_2_mlp_up_proj.safetensors2025-04-27 01:40:29,863 - INFO - exists: True2025-04-27 01:40:29,878 - INFO - factorize_layer_kron_svd2025-04-27 01:40:31,240 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:40:32,375 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:40:33,602 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 01:40:34,871 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 01:40:36,160 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 01:40:38,066 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 01:40:39,877 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:40:42,119 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:40:44,213 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 01:40:48,578 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 01:40:51,796 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 01:40:55,372 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.2.mlp.up_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_2_mlp_up_proj.safetensors TrueLayer: model.layers.2.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [4.5019283e-06 4.2492616e-06 4.1393623e-06 4.1020489e-06 4.0891123e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 01:41:47,002 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 01:41:47,003 - INFO - Replacing 'model.layers.2.mlp.up_proj' (attribute 'up_proj' within parent LlamaMLP)2025-04-27 01:41:47,009 - INFO - Compression finished. 2025-04-27 01:41:53,218 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 01:42:24,221 - INFO - wikitext2 perplexity: 7.00002025-04-27 01:42:24,221 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 01:42:34,464 - INFO - ptb perplexity: 29.25002025-04-27 01:42:34,465 - INFO - Evaluation results:2025-04-27 01:42:34,465 - INFO -   wikitext2: 7.00002025-04-27 01:42:34,465 - INFO -   ptb: 29.2500nlls.shape torch.Size([16376])Mean NLL: 3.375Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:02<00:04,  2.37s/it]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:03<00:01,  1.84s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:05<00:00,  1.57s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:05<00:00,  1.69s/it]2025-04-27 01:42:40,024 - INFO - Layer: model.layers.2.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 01:42:40,026 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_2_mlp_down_proj.safetensors2025-04-27 01:42:40,026 - INFO - exists: True2025-04-27 01:42:40,052 - INFO - factorize_layer_kron_svd2025-04-27 01:42:43,386 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:42:47,995 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 01:42:49,042 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:42:50,858 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:42:52,915 - INFO -   Factor is positive definite (alpha=1.00e-03)model.layers.2.mlp.down_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_2_mlp_down_proj.safetensors TrueLayer: model.layers.2.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=11008, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x11008)...  SVD complete. Singular values (top 5): [9.0164710e-03 9.7567434e-05 5.4176409e-05 2.1932610e-05 1.9526537e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,11008), (4096,600)factorized_sequential Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))2025-04-27 01:43:56,578 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))')2025-04-27 01:43:56,579 - INFO - Replacing 'model.layers.2.mlp.down_proj' (attribute 'down_proj' within parent LlamaMLP)2025-04-27 01:43:56,586 - INFO - Compression finished. 2025-04-27 01:44:05,380 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 01:44:35,509 - INFO - wikitext2 perplexity: 7.15622025-04-27 01:44:35,509 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.96875Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 01:44:45,483 - INFO - ptb perplexity: 28.37502025-04-27 01:44:45,483 - INFO - Evaluation results:2025-04-27 01:44:45,483 - INFO -   wikitext2: 7.15622025-04-27 01:44:45,483 - INFO -   ptb: 28.3750nlls.shape torch.Size([16376])Mean NLL: 3.34375Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:01<00:02,  1.43s/it]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:02<00:01,  1.46s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:03<00:00,  1.27s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:03<00:00,  1.32s/it]2025-04-27 01:44:49,792 - INFO - Layer: model.layers.3.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 01:44:49,794 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_3_self_attn_q_proj.safetensors2025-04-27 01:44:49,794 - INFO - exists: True2025-04-27 01:44:49,845 - INFO - factorize_layer_kron_svd2025-04-27 01:44:51,326 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:44:52,994 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 01:44:54,217 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:44:56,016 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.3.self_attn.q_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_3_self_attn_q_proj.safetensors TrueLayer: model.layers.3.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [1.1026561e-02 7.6449120e-05 6.9494883e-05 4.4865315e-05 4.0528874e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 01:45:36,236 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 01:45:36,236 - INFO - Replacing 'model.layers.3.self_attn.q_proj' (attribute 'q_proj' within parent LlamaAttention)2025-04-27 01:45:36,238 - INFO - Compression finished. 2025-04-27 01:45:44,312 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 01:46:14,784 - INFO - wikitext2 perplexity: 6.93752025-04-27 01:46:14,784 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 01:46:24,940 - INFO - ptb perplexity: 25.75002025-04-27 01:46:24,940 - INFO - Evaluation results:2025-04-27 01:46:24,940 - INFO -   wikitext2: 6.93752025-04-27 01:46:24,940 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.55it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.66it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.94it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.84it/s]2025-04-27 01:46:26,923 - INFO - Layer: model.layers.3.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 01:46:26,925 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_3_self_attn_k_proj.safetensors2025-04-27 01:46:26,925 - INFO - exists: True2025-04-27 01:46:26,935 - INFO - factorize_layer_kron_svd2025-04-27 01:46:28,018 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:46:29,091 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:46:30,158 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 01:46:31,238 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 01:46:32,318 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 01:46:33,540 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 01:46:34,616 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:46:35,704 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:46:36,790 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 01:46:37,866 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 01:46:38,954 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 01:46:40,916 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.3.self_attn.k_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_3_self_attn_k_proj.safetensors TrueLayer: model.layers.3.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [1.5212615e-05 7.6301594e-06 6.8745117e-06 6.6968514e-06 6.6398402e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 01:47:13,383 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 01:47:13,384 - INFO - Replacing 'model.layers.3.self_attn.k_proj' (attribute 'k_proj' within parent LlamaAttention)2025-04-27 01:47:13,386 - INFO - Compression finished. 2025-04-27 01:47:22,804 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 01:47:52,830 - INFO - wikitext2 perplexity: 6.93752025-04-27 01:47:52,830 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 01:48:02,723 - INFO - ptb perplexity: 25.75002025-04-27 01:48:02,724 - INFO - Evaluation results:2025-04-27 01:48:02,724 - INFO -   wikitext2: 6.93752025-04-27 01:48:02,724 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.18it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.44it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.71it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.59it/s]2025-04-27 01:48:04,974 - INFO - Layer: model.layers.3.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 01:48:04,976 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_3_self_attn_v_proj.safetensors2025-04-27 01:48:04,976 - INFO - exists: True2025-04-27 01:48:04,985 - INFO - factorize_layer_kron_svd2025-04-27 01:48:06,389 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:48:07,929 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 01:48:08,992 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:48:10,186 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:48:11,427 - INFO -   Factor is positive definite (alpha=1.00e-03)model.layers.3.self_attn.v_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_3_self_attn_v_proj.safetensors TrueLayer: model.layers.3.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [3.2220315e-03 6.8129091e-05 2.4669873e-05 1.0662832e-05 9.2806531e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 01:48:54,884 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 01:48:54,921 - INFO - Replacing 'model.layers.3.self_attn.v_proj' (attribute 'v_proj' within parent LlamaAttention)2025-04-27 01:48:54,925 - INFO - Compression finished. 2025-04-27 01:49:02,686 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 01:49:33,083 - INFO - wikitext2 perplexity: 7.00002025-04-27 01:49:33,083 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.22s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 01:49:42,998 - INFO - ptb perplexity: 25.75002025-04-27 01:49:42,999 - INFO - Evaluation results:2025-04-27 01:49:42,999 - INFO -   wikitext2: 7.00002025-04-27 01:49:42,999 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.47it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.47it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.67it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.61it/s]2025-04-27 01:49:45,199 - INFO - Layer: model.layers.3.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 01:49:45,199 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_3_self_attn_o_proj.safetensors2025-04-27 01:49:45,199 - INFO - exists: True2025-04-27 01:49:45,211 - INFO - factorize_layer_kron_svd2025-04-27 01:49:46,360 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:49:47,585 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:49:48,825 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 01:49:49,945 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:49:51,199 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.3.self_attn.o_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_3_self_attn_o_proj.safetensors TrueLayer: model.layers.3.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [3.6672582e-03 1.1360991e-04 2.1206746e-05 1.6654458e-05 1.4292441e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 01:50:31,183 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 01:50:31,183 - INFO - Replacing 'model.layers.3.self_attn.o_proj' (attribute 'o_proj' within parent LlamaAttention)2025-04-27 01:50:31,186 - INFO - Compression finished. 2025-04-27 01:50:38,645 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 01:51:08,751 - INFO - wikitext2 perplexity: 7.00002025-04-27 01:51:08,751 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.22s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.22s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 01:51:18,834 - INFO - ptb perplexity: 26.62502025-04-27 01:51:18,834 - INFO - Evaluation results:2025-04-27 01:51:18,834 - INFO -   wikitext2: 7.00002025-04-27 01:51:18,834 - INFO -   ptb: 26.6250nlls.shape torch.Size([16376])Mean NLL: 3.28125Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.53it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.63it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.66it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.64it/s]2025-04-27 01:51:21,302 - INFO - Layer: model.layers.3.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 01:51:21,303 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_3_mlp_gate_proj.safetensors2025-04-27 01:51:21,303 - INFO - exists: True2025-04-27 01:51:21,314 - INFO - factorize_layer_kron_svd2025-04-27 01:51:22,548 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:51:23,656 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:51:24,745 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 01:51:25,861 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 01:51:27,048 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 01:51:28,856 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 01:51:30,527 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:51:32,638 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:51:34,724 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 01:51:36,802 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 01:51:38,772 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 01:51:44,493 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.3.mlp.gate_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_3_mlp_gate_proj.safetensors TrueLayer: model.layers.3.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [9.7755265e-06 7.6868137e-06 6.5268773e-06 6.4694259e-06 6.0692337e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 01:52:30,561 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 01:52:30,561 - INFO - Replacing 'model.layers.3.mlp.gate_proj' (attribute 'gate_proj' within parent LlamaMLP)2025-04-27 01:52:30,570 - INFO - Compression finished. 2025-04-27 01:52:37,400 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.22s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.22s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 01:53:07,968 - INFO - wikitext2 perplexity: 7.06252025-04-27 01:53:07,969 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.953125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.22s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.22s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.22s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.22s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.20s/it]2025-04-27 01:53:18,303 - INFO - ptb perplexity: 28.75002025-04-27 01:53:18,305 - INFO - Evaluation results:2025-04-27 01:53:18,305 - INFO -   wikitext2: 7.06252025-04-27 01:53:18,305 - INFO -   ptb: 28.7500nlls.shape torch.Size([16376])Mean NLL: 3.359375Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:02<00:04,  2.14s/it]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:04<00:01,  1.98s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:05<00:00,  1.69s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:05<00:00,  1.78s/it]2025-04-27 01:53:24,070 - INFO - Layer: model.layers.3.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 01:53:24,072 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_3_mlp_up_proj.safetensors2025-04-27 01:53:24,072 - INFO - exists: True2025-04-27 01:53:24,104 - INFO - factorize_layer_kron_svd2025-04-27 01:53:25,970 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:53:27,574 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:53:29,276 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 01:53:32,083 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:53:36,529 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.3.mlp.up_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_3_mlp_up_proj.safetensors TrueLayer: model.layers.3.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [2.1761148e-03 9.0771231e-05 3.8065871e-05 1.3947105e-05 1.3033518e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 01:54:41,895 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 01:54:41,895 - INFO - Replacing 'model.layers.3.mlp.up_proj' (attribute 'up_proj' within parent LlamaMLP)2025-04-27 01:54:41,906 - INFO - Compression finished. 2025-04-27 01:54:47,580 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.22s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.22s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 01:55:17,852 - INFO - wikitext2 perplexity: 7.09382025-04-27 01:55:17,853 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9609375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 01:55:27,812 - INFO - ptb perplexity: 28.75002025-04-27 01:55:27,812 - INFO - Evaluation results:2025-04-27 01:55:27,812 - INFO -   wikitext2: 7.09382025-04-27 01:55:27,812 - INFO -   ptb: 28.7500nlls.shape torch.Size([16376])Mean NLL: 3.359375Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:01<00:03,  1.78s/it]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:03<00:01,  1.68s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:04<00:00,  1.33s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:04<00:00,  1.43s/it]2025-04-27 01:55:32,461 - INFO - Layer: model.layers.3.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 01:55:32,462 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_3_mlp_down_proj.safetensors2025-04-27 01:55:32,462 - INFO - exists: True2025-04-27 01:55:32,488 - INFO - factorize_layer_kron_svd2025-04-27 01:55:35,562 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:55:40,811 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:55:46,834 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 01:55:48,155 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:55:49,848 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.3.mlp.down_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_3_mlp_down_proj.safetensors TrueLayer: model.layers.3.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=11008, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x11008)...  SVD complete. Singular values (top 5): [2.5388924e-03 3.4759837e-04 1.6566851e-04 1.1550266e-04 6.5852117e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,11008), (4096,600)factorized_sequential Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))2025-04-27 01:57:14,054 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))')2025-04-27 01:57:14,054 - INFO - Replacing 'model.layers.3.mlp.down_proj' (attribute 'down_proj' within parent LlamaMLP)2025-04-27 01:57:14,060 - INFO - Compression finished. 2025-04-27 01:57:21,069 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.22s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 01:57:51,124 - INFO - wikitext2 perplexity: 7.06252025-04-27 01:57:51,124 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.953125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 01:58:01,426 - INFO - ptb perplexity: 27.00002025-04-27 01:58:01,426 - INFO - Evaluation results:2025-04-27 01:58:01,426 - INFO -   wikitext2: 7.06252025-04-27 01:58:01,426 - INFO -   ptb: 27.0000nlls.shape torch.Size([16376])Mean NLL: 3.296875Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:01<00:02,  1.01s/it]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.02it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:02<00:00,  1.17it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:02<00:00,  1.12it/s]2025-04-27 01:58:04,475 - INFO - Layer: model.layers.4.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 01:58:04,476 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_4_self_attn_q_proj.safetensors2025-04-27 01:58:04,476 - INFO - exists: True2025-04-27 01:58:04,515 - INFO - factorize_layer_kron_svd2025-04-27 01:58:06,054 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:58:07,498 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:58:08,966 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 01:58:10,129 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:58:11,624 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.4.self_attn.q_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_4_self_attn_q_proj.safetensors TrueLayer: model.layers.4.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [1.2226075e-02 9.3771603e-05 6.9365597e-05 3.1357977e-05 2.4107103e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 01:59:02,845 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 01:59:02,845 - INFO - Replacing 'model.layers.4.self_attn.q_proj' (attribute 'q_proj' within parent LlamaAttention)2025-04-27 01:59:02,848 - INFO - Compression finished. 2025-04-27 01:59:08,650 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 01:59:39,211 - INFO - wikitext2 perplexity: 6.93752025-04-27 01:59:39,211 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 01:59:49,181 - INFO - ptb perplexity: 25.75002025-04-27 01:59:49,182 - INFO - Evaluation results:2025-04-27 01:59:49,182 - INFO -   wikitext2: 6.93752025-04-27 01:59:49,182 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.43it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.56it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.94it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.80it/s]2025-04-27 01:59:51,225 - INFO - Layer: model.layers.4.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 01:59:51,227 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_4_self_attn_k_proj.safetensors2025-04-27 01:59:51,227 - INFO - exists: True2025-04-27 01:59:51,237 - INFO - factorize_layer_kron_svd2025-04-27 01:59:52,472 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 01:59:53,544 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 01:59:54,601 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 01:59:55,673 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 01:59:56,852 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 01:59:58,534 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 01:59:59,564 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:00:00,675 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:00:01,767 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:00:02,854 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:00:03,967 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:00:05,197 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.4.self_attn.k_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_4_self_attn_k_proj.safetensors TrueLayer: model.layers.4.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [1.5640973e-05 8.6818372e-06 8.1892204e-06 8.0699401e-06 7.7858249e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:00:48,430 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:00:48,430 - INFO - Replacing 'model.layers.4.self_attn.k_proj' (attribute 'k_proj' within parent LlamaAttention)2025-04-27 02:00:48,433 - INFO - Compression finished. 2025-04-27 02:00:55,962 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:01:25,903 - INFO - wikitext2 perplexity: 6.93752025-04-27 02:01:25,903 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.23s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.22s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.22s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.20s/it]2025-04-27 02:01:36,021 - INFO - ptb perplexity: 25.75002025-04-27 02:01:36,022 - INFO - Evaluation results:2025-04-27 02:01:36,022 - INFO -   wikitext2: 6.93752025-04-27 02:01:36,022 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.35it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.52it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.77it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.67it/s]2025-04-27 02:01:38,164 - INFO - Layer: model.layers.4.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:01:38,165 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_4_self_attn_v_proj.safetensors2025-04-27 02:01:38,165 - INFO - exists: True2025-04-27 02:01:38,174 - INFO - factorize_layer_kron_svd2025-04-27 02:01:39,675 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:01:40,921 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 02:01:41,992 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:01:43,192 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:01:44,442 - INFO -   Factor is positive definite (alpha=1.00e-03)model.layers.4.self_attn.v_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_4_self_attn_v_proj.safetensors TrueLayer: model.layers.4.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [1.2608044e-03 1.0490499e-04 2.8823766e-05 1.9398125e-05 1.6777065e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:02:33,008 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:02:33,008 - INFO - Replacing 'model.layers.4.self_attn.v_proj' (attribute 'v_proj' within parent LlamaAttention)2025-04-27 02:02:33,010 - INFO - Compression finished. 2025-04-27 02:02:39,756 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:03:09,814 - INFO - wikitext2 perplexity: 6.93752025-04-27 02:03:09,814 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:03:19,702 - INFO - ptb perplexity: 26.25002025-04-27 02:03:19,703 - INFO - Evaluation results:2025-04-27 02:03:19,703 - INFO -   wikitext2: 6.93752025-04-27 02:03:19,703 - INFO -   ptb: 26.2500nlls.shape torch.Size([16376])Mean NLL: 3.265625Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.28it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.37it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.74it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.61it/s]2025-04-27 02:03:21,911 - INFO - Layer: model.layers.4.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:03:21,912 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_4_self_attn_o_proj.safetensors2025-04-27 02:03:21,912 - INFO - exists: True2025-04-27 02:03:21,928 - INFO - factorize_layer_kron_svd2025-04-27 02:03:23,256 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:03:24,438 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:03:25,681 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:03:26,827 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:03:28,059 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.4.self_attn.o_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_4_self_attn_o_proj.safetensors TrueLayer: model.layers.4.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [2.9492390e-03 9.1232723e-05 3.2022173e-05 2.4443221e-05 1.9350224e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:04:01,274 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:04:01,274 - INFO - Replacing 'model.layers.4.self_attn.o_proj' (attribute 'o_proj' within parent LlamaAttention)2025-04-27 02:04:01,278 - INFO - Compression finished. 2025-04-27 02:04:08,829 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:04:39,232 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:04:39,232 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:04:49,358 - INFO - ptb perplexity: 26.25002025-04-27 02:04:49,358 - INFO - Evaluation results:2025-04-27 02:04:49,358 - INFO -   wikitext2: 7.00002025-04-27 02:04:49,358 - INFO -   ptb: 26.2500nlls.shape torch.Size([16376])Mean NLL: 3.265625Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:01<00:02,  1.25s/it]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:02<00:01,  1.25s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:03<00:00,  1.11s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:03<00:00,  1.15s/it]2025-04-27 02:04:53,135 - INFO - Layer: model.layers.4.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:04:53,135 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_4_mlp_gate_proj.safetensors2025-04-27 02:04:53,135 - INFO - exists: True2025-04-27 02:04:53,167 - INFO - factorize_layer_kron_svd2025-04-27 02:04:55,203 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:04:56,350 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:04:57,481 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:04:58,577 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:04:59,703 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:05:01,151 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 02:05:02,838 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:05:04,743 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:05:06,598 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:05:08,536 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:05:10,665 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:05:13,588 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.4.mlp.gate_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_4_mlp_gate_proj.safetensors TrueLayer: model.layers.4.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [1.0836617e-05 6.9572156e-06 6.8608979e-06 6.6034477e-06 6.4066685e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 02:05:54,258 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 02:05:54,258 - INFO - Replacing 'model.layers.4.mlp.gate_proj' (attribute 'gate_proj' within parent LlamaMLP)2025-04-27 02:05:54,265 - INFO - Compression finished. 2025-04-27 02:06:01,951 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:06:32,528 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:06:32,528 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:06:42,492 - INFO - ptb perplexity: 26.25002025-04-27 02:06:42,493 - INFO - Evaluation results:2025-04-27 02:06:42,493 - INFO -   wikitext2: 7.00002025-04-27 02:06:42,493 - INFO -   ptb: 26.2500nlls.shape torch.Size([16376])Mean NLL: 3.265625Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:02<00:05,  2.54s/it]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:05<00:02,  2.65s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:06<00:00,  2.20s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:06<00:00,  2.31s/it]2025-04-27 02:06:50,245 - INFO - Layer: model.layers.4.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:06:50,246 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_4_mlp_up_proj.safetensors2025-04-27 02:06:50,246 - INFO - exists: True2025-04-27 02:06:50,268 - INFO - factorize_layer_kron_svd2025-04-27 02:06:51,548 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:06:52,678 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:06:53,812 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:06:54,909 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:06:56,058 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:06:57,255 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 02:06:58,984 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:07:00,941 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:07:02,859 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:07:04,821 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:07:06,745 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:07:09,760 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.4.mlp.up_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_4_mlp_up_proj.safetensors TrueLayer: model.layers.4.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [4.2674606e-06 3.9633169e-06 3.8188300e-06 3.7764739e-06 3.7316508e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 02:07:57,108 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 02:07:57,109 - INFO - Replacing 'model.layers.4.mlp.up_proj' (attribute 'up_proj' within parent LlamaMLP)2025-04-27 02:07:57,117 - INFO - Compression finished. 2025-04-27 02:08:07,593 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.22s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.22s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.22s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.22s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.22s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:17,  1.22s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:08:38,311 - INFO - wikitext2 perplexity: 7.09382025-04-27 02:08:38,311 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9609375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.22s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.22s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.22s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.22s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.18s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.20s/it]2025-04-27 02:08:48,437 - INFO - ptb perplexity: 27.50002025-04-27 02:08:48,438 - INFO - Evaluation results:2025-04-27 02:08:48,438 - INFO -   wikitext2: 7.09382025-04-27 02:08:48,438 - INFO -   ptb: 27.5000nlls.shape torch.Size([16376])Mean NLL: 3.3125Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:02<00:05,  2.64s/it]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:05<00:02,  2.52s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:07<00:00,  2.30s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:07<00:00,  2.37s/it]2025-04-27 02:08:56,249 - INFO - Layer: model.layers.4.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:08:56,251 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_4_mlp_down_proj.safetensors2025-04-27 02:08:56,251 - INFO - exists: True2025-04-27 02:08:56,320 - INFO - factorize_layer_kron_svd2025-04-27 02:08:59,470 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:09:02,047 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:09:04,930 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:09:06,008 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:09:07,207 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:09:08,453 - INFO -   Factor is positive definite (alpha=1.00e-03)model.layers.4.mlp.down_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_4_mlp_down_proj.safetensors TrueLayer: model.layers.4.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=11008, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x11008)...  SVD complete. Singular values (top 5): [2.7665207e-02 6.1080464e-05 2.8755128e-05 2.1798001e-05 1.3714681e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,11008), (4096,600)factorized_sequential Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))2025-04-27 02:09:56,387 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))')2025-04-27 02:09:56,387 - INFO - Replacing 'model.layers.4.mlp.down_proj' (attribute 'down_proj' within parent LlamaMLP)2025-04-27 02:09:56,394 - INFO - Compression finished. 2025-04-27 02:10:03,652 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:10:33,905 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:10:33,905 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:10:44,187 - INFO - ptb perplexity: 27.00002025-04-27 02:10:44,188 - INFO - Evaluation results:2025-04-27 02:10:44,188 - INFO -   wikitext2: 7.00002025-04-27 02:10:44,188 - INFO -   ptb: 27.0000nlls.shape torch.Size([16376])Mean NLL: 3.296875Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:01<00:03,  1.87s/it]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:03<00:01,  1.59s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:04<00:00,  1.29s/it]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:04<00:00,  1.40s/it]2025-04-27 02:10:48,900 - INFO - Layer: model.layers.5.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:10:48,902 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_5_self_attn_q_proj.safetensors2025-04-27 02:10:48,902 - INFO - exists: True2025-04-27 02:10:48,933 - INFO - factorize_layer_kron_svd2025-04-27 02:10:50,499 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:10:51,707 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:10:53,292 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:10:54,489 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:10:56,182 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.5.self_attn.q_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_5_self_attn_q_proj.safetensors TrueLayer: model.layers.5.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [6.0884668e-03 2.0925709e-04 1.1838539e-04 6.3284489e-05 3.6360856e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:11:19,253 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:11:19,253 - INFO - Replacing 'model.layers.5.self_attn.q_proj' (attribute 'q_proj' within parent LlamaAttention)2025-04-27 02:11:19,257 - INFO - Compression finished. 2025-04-27 02:11:24,972 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:11:54,960 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:11:54,960 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:12:05,069 - INFO - ptb perplexity: 26.25002025-04-27 02:12:05,069 - INFO - Evaluation results:2025-04-27 02:12:05,069 - INFO -   wikitext2: 7.00002025-04-27 02:12:05,069 - INFO -   ptb: 26.2500nlls.shape torch.Size([16376])Mean NLL: 3.265625Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.52it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.63it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.87it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.78it/s]2025-04-27 02:12:07,164 - INFO - Layer: model.layers.5.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:12:07,166 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_5_self_attn_k_proj.safetensors2025-04-27 02:12:07,167 - INFO - exists: True2025-04-27 02:12:07,175 - INFO - factorize_layer_kron_svd2025-04-27 02:12:08,468 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:12:09,626 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 02:12:10,697 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:12:11,890 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.5.self_attn.k_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_5_self_attn_k_proj.safetensors TrueLayer: model.layers.5.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [4.8379018e-03 1.5238064e-04 9.5437594e-05 3.4556335e-05 3.0823277e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:12:33,762 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:12:33,762 - INFO - Replacing 'model.layers.5.self_attn.k_proj' (attribute 'k_proj' within parent LlamaAttention)2025-04-27 02:12:33,764 - INFO - Compression finished. 2025-04-27 02:12:40,030 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:13:10,045 - INFO - wikitext2 perplexity: 6.93752025-04-27 02:13:10,046 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:13:19,919 - INFO - ptb perplexity: 25.75002025-04-27 02:13:19,919 - INFO - Evaluation results:2025-04-27 02:13:19,919 - INFO -   wikitext2: 6.93752025-04-27 02:13:19,919 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.38it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.41it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.67it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.59it/s]2025-04-27 02:13:22,232 - INFO - Layer: model.layers.5.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:13:22,235 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_5_self_attn_v_proj.safetensors2025-04-27 02:13:22,235 - INFO - exists: True2025-04-27 02:13:22,264 - INFO - factorize_layer_kron_svd2025-04-27 02:13:23,948 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:13:25,150 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 02:13:26,232 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:13:27,386 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:13:28,604 - INFO -   Factor is positive definite (alpha=1.00e-03)model.layers.5.self_attn.v_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_5_self_attn_v_proj.safetensors TrueLayer: model.layers.5.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [1.6850128e-03 9.8373624e-05 4.0382714e-05 2.6431540e-05 1.4974664e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:13:49,579 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:13:49,579 - INFO - Replacing 'model.layers.5.self_attn.v_proj' (attribute 'v_proj' within parent LlamaAttention)2025-04-27 02:13:49,583 - INFO - Compression finished. 2025-04-27 02:13:55,157 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:14:25,450 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:14:25,450 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:14:35,360 - INFO - ptb perplexity: 27.00002025-04-27 02:14:35,360 - INFO - Evaluation results:2025-04-27 02:14:35,360 - INFO -   wikitext2: 7.00002025-04-27 02:14:35,360 - INFO -   ptb: 27.0000nlls.shape torch.Size([16376])Mean NLL: 3.296875Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.35it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.49it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.76it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.66it/s]2025-04-27 02:14:37,575 - INFO - Layer: model.layers.5.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:14:37,577 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_5_self_attn_o_proj.safetensors2025-04-27 02:14:37,577 - INFO - exists: True2025-04-27 02:14:37,587 - INFO - factorize_layer_kron_svd2025-04-27 02:14:38,863 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:14:40,024 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:14:41,225 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:14:42,334 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:14:43,547 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.5.self_attn.o_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_5_self_attn_o_proj.safetensors TrueLayer: model.layers.5.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [1.8749139e-03 8.3391576e-05 2.2733295e-05 1.8737563e-05 1.7023393e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:15:04,359 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:15:04,359 - INFO - Replacing 'model.layers.5.self_attn.o_proj' (attribute 'o_proj' within parent LlamaAttention)2025-04-27 02:15:04,362 - INFO - Compression finished. 2025-04-27 02:15:10,485 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:15:40,313 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:15:40,313 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:15:50,221 - INFO - ptb perplexity: 26.62502025-04-27 02:15:50,222 - INFO - Evaluation results:2025-04-27 02:15:50,222 - INFO -   wikitext2: 7.00002025-04-27 02:15:50,222 - INFO -   ptb: 26.6250nlls.shape torch.Size([16376])Mean NLL: 3.28125Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.30it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.40it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.67it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.57it/s]2025-04-27 02:15:52,475 - INFO - Layer: model.layers.5.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:15:52,480 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_5_mlp_gate_proj.safetensors2025-04-27 02:15:52,480 - INFO - exists: True2025-04-27 02:15:52,530 - INFO - factorize_layer_kron_svd2025-04-27 02:15:55,060 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:15:56,195 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:15:57,416 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:15:59,163 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:16:02,096 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.5.mlp.gate_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_5_mlp_gate_proj.safetensors TrueLayer: model.layers.5.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [4.2831539e-03 2.1835518e-04 5.4689150e-05 2.2678400e-05 1.5060915e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 02:16:44,401 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 02:16:44,402 - INFO - Replacing 'model.layers.5.mlp.gate_proj' (attribute 'gate_proj' within parent LlamaMLP)2025-04-27 02:16:44,410 - INFO - Compression finished. 2025-04-27 02:16:50,984 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:17:20,859 - INFO - wikitext2 perplexity: 7.06252025-04-27 02:17:20,860 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.953125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:17:30,767 - INFO - ptb perplexity: 26.62502025-04-27 02:17:30,768 - INFO - Evaluation results:2025-04-27 02:17:30,768 - INFO -   wikitext2: 7.06252025-04-27 02:17:30,768 - INFO -   ptb: 26.6250nlls.shape torch.Size([16376])Mean NLL: 3.28125Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.63it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.69it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  2.03it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.91it/s]2025-04-27 02:17:32,705 - INFO - Layer: model.layers.5.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:17:32,706 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_5_mlp_up_proj.safetensors2025-04-27 02:17:32,707 - INFO - exists: True2025-04-27 02:17:32,757 - INFO - factorize_layer_kron_svd2025-04-27 02:17:34,852 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:17:35,892 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:17:36,914 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:17:37,939 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:17:38,974 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:17:40,131 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 02:17:41,686 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:17:43,513 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:17:45,302 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:17:47,095 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:17:48,927 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:17:51,942 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.5.mlp.up_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_5_mlp_up_proj.safetensors TrueLayer: model.layers.5.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [4.4357857e-06 4.1288258e-06 4.0088476e-06 3.9555139e-06 3.8984172e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 02:18:37,261 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 02:18:37,261 - INFO - Replacing 'model.layers.5.mlp.up_proj' (attribute 'up_proj' within parent LlamaMLP)2025-04-27 02:18:37,268 - INFO - Compression finished. 2025-04-27 02:18:42,195 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:19:12,245 - INFO - wikitext2 perplexity: 7.09382025-04-27 02:19:12,245 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9609375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:19:22,180 - INFO - ptb perplexity: 27.50002025-04-27 02:19:22,180 - INFO - Evaluation results:2025-04-27 02:19:22,180 - INFO -   wikitext2: 7.09382025-04-27 02:19:22,180 - INFO -   ptb: 27.5000nlls.shape torch.Size([16376])Mean NLL: 3.3125Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.68it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.71it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.99it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.90it/s]2025-04-27 02:19:24,102 - INFO - Layer: model.layers.5.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:19:24,103 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_5_mlp_down_proj.safetensors2025-04-27 02:19:24,103 - INFO - exists: True2025-04-27 02:19:24,119 - INFO - factorize_layer_kron_svd2025-04-27 02:19:26,022 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:19:28,921 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:19:32,000 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:19:33,059 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:19:34,249 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:19:35,468 - INFO -   Factor is positive definite (alpha=1.00e-03)model.layers.5.mlp.down_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_5_mlp_down_proj.safetensors TrueLayer: model.layers.5.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=11008, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x11008)...  SVD complete. Singular values (top 5): [4.2569707e-03 5.2021828e-04 9.3271483e-05 6.7189409e-05 5.4636472e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,11008), (4096,600)factorized_sequential Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))2025-04-27 02:20:36,200 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))')2025-04-27 02:20:36,200 - INFO - Replacing 'model.layers.5.mlp.down_proj' (attribute 'down_proj' within parent LlamaMLP)2025-04-27 02:20:36,209 - INFO - Compression finished. 2025-04-27 02:20:43,034 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:21:13,095 - INFO - wikitext2 perplexity: 7.06252025-04-27 02:21:13,095 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.953125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:21:23,010 - INFO - ptb perplexity: 26.62502025-04-27 02:21:23,011 - INFO - Evaluation results:2025-04-27 02:21:23,011 - INFO -   wikitext2: 7.06252025-04-27 02:21:23,011 - INFO -   ptb: 26.6250nlls.shape torch.Size([16376])Mean NLL: 3.28125Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.46it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.58it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.83it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.74it/s]2025-04-27 02:21:25,078 - INFO - Layer: model.layers.6.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:21:25,079 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_6_self_attn_q_proj.safetensors2025-04-27 02:21:25,079 - INFO - exists: True2025-04-27 02:21:25,108 - INFO - factorize_layer_kron_svd2025-04-27 02:21:26,343 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:21:27,378 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:21:28,419 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:21:29,488 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:21:30,522 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:21:31,758 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 02:21:32,831 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:21:33,901 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:21:34,946 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:21:35,999 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:21:37,032 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:21:38,241 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.6.self_attn.q_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_6_self_attn_q_proj.safetensors TrueLayer: model.layers.6.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [1.2221675e-05 8.1780718e-06 7.9897936e-06 7.7061068e-06 7.4714530e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:22:08,057 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:22:08,057 - INFO - Replacing 'model.layers.6.self_attn.q_proj' (attribute 'q_proj' within parent LlamaAttention)2025-04-27 02:22:08,061 - INFO - Compression finished. 2025-04-27 02:22:13,035 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:22:43,186 - INFO - wikitext2 perplexity: 6.93752025-04-27 02:22:43,186 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:22:53,370 - INFO - ptb perplexity: 25.75002025-04-27 02:22:53,370 - INFO - Evaluation results:2025-04-27 02:22:53,370 - INFO -   wikitext2: 6.93752025-04-27 02:22:53,370 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.66it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.66it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  2.01it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.90it/s]2025-04-27 02:22:55,345 - INFO - Layer: model.layers.6.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:22:55,346 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_6_self_attn_k_proj.safetensors2025-04-27 02:22:55,346 - INFO - exists: True2025-04-27 02:22:55,367 - INFO - factorize_layer_kron_svd2025-04-27 02:22:57,490 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:22:58,549 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:22:59,615 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:23:00,680 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:23:01,747 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:23:02,960 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 02:23:04,045 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:23:05,114 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:23:06,190 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:23:07,265 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:23:08,334 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:23:09,618 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.6.self_attn.k_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_6_self_attn_k_proj.safetensors TrueLayer: model.layers.6.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [1.4503589e-05 7.8944504e-06 7.5118478e-06 7.3252472e-06 7.0036058e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:23:38,934 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:23:38,934 - INFO - Replacing 'model.layers.6.self_attn.k_proj' (attribute 'k_proj' within parent LlamaAttention)2025-04-27 02:23:38,937 - INFO - Compression finished. 2025-04-27 02:23:44,710 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:24:15,115 - INFO - wikitext2 perplexity: 6.93752025-04-27 02:24:15,115 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:24:25,057 - INFO - ptb perplexity: 26.25002025-04-27 02:24:25,057 - INFO - Evaluation results:2025-04-27 02:24:25,057 - INFO -   wikitext2: 6.93752025-04-27 02:24:25,057 - INFO -   ptb: 26.2500nlls.shape torch.Size([16376])Mean NLL: 3.265625Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.62it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.69it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.99it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.89it/s]2025-04-27 02:24:26,994 - INFO - Layer: model.layers.6.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:24:26,995 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_6_self_attn_v_proj.safetensors2025-04-27 02:24:26,995 - INFO - exists: True2025-04-27 02:24:27,018 - INFO - factorize_layer_kron_svd2025-04-27 02:24:28,296 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:24:29,505 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 02:24:30,563 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:24:31,704 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:24:32,918 - INFO -   Factor is positive definite (alpha=1.00e-03)model.layers.6.self_attn.v_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_6_self_attn_v_proj.safetensors TrueLayer: model.layers.6.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [8.6327567e-04 1.0010644e-04 3.2394990e-05 2.0883237e-05 1.4535663e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:24:54,455 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:24:54,455 - INFO - Replacing 'model.layers.6.self_attn.v_proj' (attribute 'v_proj' within parent LlamaAttention)2025-04-27 02:24:54,459 - INFO - Compression finished. 2025-04-27 02:24:58,521 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:25:28,381 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:25:28,382 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:25:38,423 - INFO - ptb perplexity: 26.25002025-04-27 02:25:38,423 - INFO - Evaluation results:2025-04-27 02:25:38,423 - INFO -   wikitext2: 7.00002025-04-27 02:25:38,423 - INFO -   ptb: 26.2500nlls.shape torch.Size([16376])Mean NLL: 3.265625Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.15it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.42it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.71it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.58it/s]2025-04-27 02:25:40,673 - INFO - Layer: model.layers.6.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:25:40,674 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_6_self_attn_o_proj.safetensors2025-04-27 02:25:40,674 - INFO - exists: True2025-04-27 02:25:40,686 - INFO - factorize_layer_kron_svd2025-04-27 02:25:41,963 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:25:43,108 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:25:44,342 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:25:45,430 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:25:46,654 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.6.self_attn.o_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_6_self_attn_o_proj.safetensors TrueLayer: model.layers.6.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [1.7411467e-03 5.2356190e-05 3.5366571e-05 1.9945815e-05 1.7165841e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:26:15,133 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:26:15,133 - INFO - Replacing 'model.layers.6.self_attn.o_proj' (attribute 'o_proj' within parent LlamaAttention)2025-04-27 02:26:15,136 - INFO - Compression finished. 2025-04-27 02:26:20,533 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:26:50,751 - INFO - wikitext2 perplexity: 7.06252025-04-27 02:26:50,752 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.953125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:27:00,842 - INFO - ptb perplexity: 26.62502025-04-27 02:27:00,842 - INFO - Evaluation results:2025-04-27 02:27:00,842 - INFO -   wikitext2: 7.06252025-04-27 02:27:00,842 - INFO -   ptb: 26.6250nlls.shape torch.Size([16376])Mean NLL: 3.28125Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.53it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.54it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.76it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.69it/s]2025-04-27 02:27:02,967 - INFO - Layer: model.layers.6.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:27:02,969 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_6_mlp_gate_proj.safetensors2025-04-27 02:27:02,969 - INFO - exists: True2025-04-27 02:27:02,973 - INFO - factorize_layer_kron_svd2025-04-27 02:27:04,142 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:27:05,199 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:27:06,236 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:27:07,275 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:27:08,318 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:27:09,486 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 02:27:11,073 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:27:12,873 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:27:14,671 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:27:16,449 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:27:18,230 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:27:21,212 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.6.mlp.gate_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_6_mlp_gate_proj.safetensors TrueLayer: model.layers.6.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [1.3830311e-05 7.5414341e-06 7.1951326e-06 7.1753102e-06 6.8685222e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 02:28:08,281 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 02:28:08,282 - INFO - Replacing 'model.layers.6.mlp.gate_proj' (attribute 'gate_proj' within parent LlamaMLP)2025-04-27 02:28:08,290 - INFO - Compression finished. 2025-04-27 02:28:14,475 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:28:44,491 - INFO - wikitext2 perplexity: 7.06252025-04-27 02:28:44,492 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.953125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:28:54,410 - INFO - ptb perplexity: 27.00002025-04-27 02:28:54,410 - INFO - Evaluation results:2025-04-27 02:28:54,410 - INFO -   wikitext2: 7.06252025-04-27 02:28:54,410 - INFO -   ptb: 27.0000nlls.shape torch.Size([16376])Mean NLL: 3.296875Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.50it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.60it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.83it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.75it/s]2025-04-27 02:28:56,690 - INFO - Layer: model.layers.6.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:28:56,692 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_6_mlp_up_proj.safetensors2025-04-27 02:28:56,692 - INFO - exists: True2025-04-27 02:28:56,763 - INFO - factorize_layer_kron_svd2025-04-27 02:28:59,986 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:29:01,123 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:29:02,296 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:29:04,039 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:29:07,026 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.6.mlp.up_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_6_mlp_up_proj.safetensors TrueLayer: model.layers.6.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [4.4995304e-03 1.7962435e-04 3.1673346e-05 2.0401058e-05 1.7842272e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 02:29:51,385 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 02:29:51,386 - INFO - Replacing 'model.layers.6.mlp.up_proj' (attribute 'up_proj' within parent LlamaMLP)2025-04-27 02:29:51,392 - INFO - Compression finished. 2025-04-27 02:29:56,983 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:30:26,784 - INFO - wikitext2 perplexity: 7.09382025-04-27 02:30:26,784 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9609375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:30:36,657 - INFO - ptb perplexity: 27.50002025-04-27 02:30:36,657 - INFO - Evaluation results:2025-04-27 02:30:36,657 - INFO -   wikitext2: 7.09382025-04-27 02:30:36,657 - INFO -   ptb: 27.5000nlls.shape torch.Size([16376])Mean NLL: 3.3125Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.56it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.52it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.77it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.70it/s]2025-04-27 02:30:38,774 - INFO - Layer: model.layers.6.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:30:38,776 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_6_mlp_down_proj.safetensors2025-04-27 02:30:38,776 - INFO - exists: True2025-04-27 02:30:38,788 - INFO - factorize_layer_kron_svd2025-04-27 02:30:40,828 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:30:44,324 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 02:30:45,351 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:30:46,500 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:30:47,745 - INFO -   Factor is positive definite (alpha=1.00e-03)model.layers.6.mlp.down_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_6_mlp_down_proj.safetensors TrueLayer: model.layers.6.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=11008, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x11008)...  SVD complete. Singular values (top 5): [1.1730455e-02 7.5274904e-05 5.8971975e-05 3.9316310e-05 2.7261001e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,11008), (4096,600)factorized_sequential Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))2025-04-27 02:31:51,411 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))')2025-04-27 02:31:51,411 - INFO - Replacing 'model.layers.6.mlp.down_proj' (attribute 'down_proj' within parent LlamaMLP)2025-04-27 02:31:51,421 - INFO - Compression finished. 2025-04-27 02:32:02,305 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:32:32,702 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:32:32,702 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:32:42,685 - INFO - ptb perplexity: 26.62502025-04-27 02:32:42,685 - INFO - Evaluation results:2025-04-27 02:32:42,685 - INFO -   wikitext2: 7.00002025-04-27 02:32:42,685 - INFO -   ptb: 26.6250nlls.shape torch.Size([16376])Mean NLL: 3.28125Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.47it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.46it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.70it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.63it/s]2025-04-27 02:32:44,901 - INFO - Layer: model.layers.7.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:32:44,903 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_7_self_attn_q_proj.safetensors2025-04-27 02:32:44,903 - INFO - exists: True2025-04-27 02:32:44,938 - INFO - factorize_layer_kron_svd2025-04-27 02:32:47,602 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:32:48,869 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 02:32:49,948 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:32:51,221 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.7.self_attn.q_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_7_self_attn_q_proj.safetensors TrueLayer: model.layers.7.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [4.46691271e-03 1.17237636e-04 4.46072554e-05 2.93035046e-05 2.62491722e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:33:19,663 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:33:19,663 - INFO - Replacing 'model.layers.7.self_attn.q_proj' (attribute 'q_proj' within parent LlamaAttention)2025-04-27 02:33:19,666 - INFO - Compression finished. 2025-04-27 02:33:23,093 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:33:53,580 - INFO - wikitext2 perplexity: 6.93752025-04-27 02:33:53,580 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:34:03,532 - INFO - ptb perplexity: 25.75002025-04-27 02:34:03,532 - INFO - Evaluation results:2025-04-27 02:34:03,532 - INFO -   wikitext2: 6.93752025-04-27 02:34:03,532 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.53it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.64it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.98it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.86it/s]2025-04-27 02:34:05,494 - INFO - Layer: model.layers.7.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:34:05,497 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_7_self_attn_k_proj.safetensors2025-04-27 02:34:05,497 - INFO - exists: True2025-04-27 02:34:05,526 - INFO - factorize_layer_kron_svd2025-04-27 02:34:08,179 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:34:09,461 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 02:34:10,526 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:34:11,771 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.7.self_attn.k_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_7_self_attn_k_proj.safetensors TrueLayer: model.layers.7.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [4.3513221e-03 9.5677962e-05 5.9629248e-05 3.8686332e-05 2.6624961e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:34:41,859 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:34:41,859 - INFO - Replacing 'model.layers.7.self_attn.k_proj' (attribute 'k_proj' within parent LlamaAttention)2025-04-27 02:34:41,862 - INFO - Compression finished. 2025-04-27 02:34:46,141 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:35:16,193 - INFO - wikitext2 perplexity: 6.93752025-04-27 02:35:16,193 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:35:26,076 - INFO - ptb perplexity: 25.75002025-04-27 02:35:26,077 - INFO - Evaluation results:2025-04-27 02:35:26,077 - INFO -   wikitext2: 6.93752025-04-27 02:35:26,077 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.63it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.61it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.88it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.80it/s]2025-04-27 02:35:28,338 - INFO - Layer: model.layers.7.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:35:28,340 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_7_self_attn_v_proj.safetensors2025-04-27 02:35:28,340 - INFO - exists: True2025-04-27 02:35:28,349 - INFO - factorize_layer_kron_svd2025-04-27 02:35:29,617 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:35:30,673 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:35:31,721 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:35:32,790 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:35:33,884 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:35:35,147 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 02:35:36,192 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:35:37,240 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:35:38,284 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:35:39,328 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:35:40,373 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:35:41,556 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.7.self_attn.v_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_7_self_attn_v_proj.safetensors TrueLayer: model.layers.7.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [3.1055349e-06 3.0262872e-06 2.9694913e-06 2.8873151e-06 2.8518862e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:36:02,725 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:36:02,725 - INFO - Replacing 'model.layers.7.self_attn.v_proj' (attribute 'v_proj' within parent LlamaAttention)2025-04-27 02:36:02,728 - INFO - Compression finished. 2025-04-27 02:36:06,237 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:36:37,384 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:36:37,384 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:36:47,308 - INFO - ptb perplexity: 26.25002025-04-27 02:36:47,308 - INFO - Evaluation results:2025-04-27 02:36:47,308 - INFO -   wikitext2: 7.00002025-04-27 02:36:47,308 - INFO -   ptb: 26.2500nlls.shape torch.Size([16376])Mean NLL: 3.265625Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.43it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.44it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.74it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.65it/s]2025-04-27 02:36:49,487 - INFO - Layer: model.layers.7.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:36:49,489 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_7_self_attn_o_proj.safetensors2025-04-27 02:36:49,489 - INFO - exists: True2025-04-27 02:36:49,513 - INFO - factorize_layer_kron_svd2025-04-27 02:36:52,456 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:36:53,641 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:36:54,919 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:36:55,994 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:36:57,264 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.7.self_attn.o_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_7_self_attn_o_proj.safetensors TrueLayer: model.layers.7.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [3.87209147e-04 1.13781534e-04 2.00952127e-05 1.35337359e-05 1.19228489e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:37:22,363 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:37:22,363 - INFO - Replacing 'model.layers.7.self_attn.o_proj' (attribute 'o_proj' within parent LlamaAttention)2025-04-27 02:37:22,366 - INFO - Compression finished. 2025-04-27 02:37:26,198 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:37:56,647 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:37:56,647 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:38:06,548 - INFO - ptb perplexity: 26.62502025-04-27 02:38:06,548 - INFO - Evaluation results:2025-04-27 02:38:06,549 - INFO -   wikitext2: 7.00002025-04-27 02:38:06,549 - INFO -   ptb: 26.6250nlls.shape torch.Size([16376])Mean NLL: 3.28125Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.52it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.52it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.89it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.77it/s]2025-04-27 02:38:08,603 - INFO - Layer: model.layers.7.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:38:08,605 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_7_mlp_gate_proj.safetensors2025-04-27 02:38:08,605 - INFO - exists: True2025-04-27 02:38:08,614 - INFO - factorize_layer_kron_svd2025-04-27 02:38:09,841 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:38:11,010 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:38:12,210 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:38:14,020 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:38:17,279 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.7.mlp.gate_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_7_mlp_gate_proj.safetensors TrueLayer: model.layers.7.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [6.1598225e-03 4.3083266e-05 2.9594266e-05 2.0862246e-05 1.8714514e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 02:39:08,974 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 02:39:08,975 - INFO - Replacing 'model.layers.7.mlp.gate_proj' (attribute 'gate_proj' within parent LlamaMLP)2025-04-27 02:39:08,982 - INFO - Compression finished. 2025-04-27 02:39:17,375 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:39:48,516 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:39:48,517 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:39:58,508 - INFO - ptb perplexity: 26.25002025-04-27 02:39:58,508 - INFO - Evaluation results:2025-04-27 02:39:58,508 - INFO -   wikitext2: 7.00002025-04-27 02:39:58,508 - INFO -   ptb: 26.2500nlls.shape torch.Size([16376])Mean NLL: 3.265625Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.46it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.49it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.86it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.74it/s]2025-04-27 02:40:00,602 - INFO - Layer: model.layers.7.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:40:00,605 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_7_mlp_up_proj.safetensors2025-04-27 02:40:00,605 - INFO - exists: True2025-04-27 02:40:00,636 - INFO - factorize_layer_kron_svd2025-04-27 02:40:01,862 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:40:03,036 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:40:04,279 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:40:06,204 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:40:09,396 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.7.mlp.up_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_7_mlp_up_proj.safetensors TrueLayer: model.layers.7.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [2.8216012e-03 3.8601193e-05 2.6869149e-05 2.3445984e-05 1.8939305e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 02:40:54,370 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 02:40:54,370 - INFO - Replacing 'model.layers.7.mlp.up_proj' (attribute 'up_proj' within parent LlamaMLP)2025-04-27 02:40:54,379 - INFO - Compression finished. 2025-04-27 02:41:01,659 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:41:31,497 - INFO - wikitext2 perplexity: 7.06252025-04-27 02:41:31,497 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.953125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:41:41,440 - INFO - ptb perplexity: 27.00002025-04-27 02:41:41,441 - INFO - Evaluation results:2025-04-27 02:41:41,441 - INFO -   wikitext2: 7.06252025-04-27 02:41:41,441 - INFO -   ptb: 27.0000nlls.shape torch.Size([16376])Mean NLL: 3.296875Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.01it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.25it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:02<00:00,  1.58it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:02<00:00,  1.44it/s]2025-04-27 02:41:43,879 - INFO - Layer: model.layers.7.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:41:43,881 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_7_mlp_down_proj.safetensors2025-04-27 02:41:43,881 - INFO - exists: True2025-04-27 02:41:43,945 - INFO - factorize_layer_kron_svd2025-04-27 02:41:46,608 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:41:49,711 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 02:41:50,748 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:41:51,879 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:41:53,107 - INFO -   Factor is positive definite (alpha=1.00e-03)model.layers.7.mlp.down_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_7_mlp_down_proj.safetensors TrueLayer: model.layers.7.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=11008, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x11008)...  SVD complete. Singular values (top 5): [4.0638614e-03 2.6415018e-04 8.9995185e-05 2.9939682e-05 2.5749245e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,11008), (4096,600)factorized_sequential Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))2025-04-27 02:42:45,949 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))')2025-04-27 02:42:45,949 - INFO - Replacing 'model.layers.7.mlp.down_proj' (attribute 'down_proj' within parent LlamaMLP)2025-04-27 02:42:45,958 - INFO - Compression finished. 2025-04-27 02:42:51,428 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:43:21,557 - INFO - wikitext2 perplexity: 6.93752025-04-27 02:43:21,557 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:43:31,912 - INFO - ptb perplexity: 26.25002025-04-27 02:43:31,913 - INFO - Evaluation results:2025-04-27 02:43:31,913 - INFO -   wikitext2: 6.93752025-04-27 02:43:31,913 - INFO -   ptb: 26.2500nlls.shape torch.Size([16376])Mean NLL: 3.265625Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.47it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.62it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.95it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.82it/s]2025-04-27 02:43:33,954 - INFO - Layer: model.layers.8.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:43:33,956 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_8_self_attn_q_proj.safetensors2025-04-27 02:43:33,956 - INFO - exists: True2025-04-27 02:43:33,979 - INFO - factorize_layer_kron_svd2025-04-27 02:43:35,277 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:43:36,492 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:43:37,718 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:43:38,782 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:43:40,019 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.8.self_attn.q_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_8_self_attn_q_proj.safetensors TrueLayer: model.layers.8.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [5.8933757e-03 1.1251512e-04 4.9954931e-05 2.4490531e-05 1.9172267e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:44:03,054 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:44:03,054 - INFO - Replacing 'model.layers.8.self_attn.q_proj' (attribute 'q_proj' within parent LlamaAttention)2025-04-27 02:44:03,057 - INFO - Compression finished. 2025-04-27 02:44:06,320 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:44:36,328 - INFO - wikitext2 perplexity: 6.93752025-04-27 02:44:36,328 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:44:46,262 - INFO - ptb perplexity: 25.75002025-04-27 02:44:46,262 - INFO - Evaluation results:2025-04-27 02:44:46,262 - INFO -   wikitext2: 6.93752025-04-27 02:44:46,262 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.58it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.59it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.86it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.78it/s]2025-04-27 02:44:48,317 - INFO - Layer: model.layers.8.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:44:48,319 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_8_self_attn_k_proj.safetensors2025-04-27 02:44:48,319 - INFO - exists: True2025-04-27 02:44:48,330 - INFO - factorize_layer_kron_svd2025-04-27 02:44:49,609 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:44:50,684 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:44:51,747 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:44:52,811 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:44:53,874 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:44:55,106 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 02:44:56,156 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:44:57,235 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:44:58,304 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:44:59,343 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:45:00,413 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:45:01,864 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.8.self_attn.k_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_8_self_attn_k_proj.safetensors TrueLayer: model.layers.8.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [1.4188925e-05 7.6309198e-06 7.4526779e-06 7.2449202e-06 6.7348119e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:45:29,938 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:45:29,938 - INFO - Replacing 'model.layers.8.self_attn.k_proj' (attribute 'k_proj' within parent LlamaAttention)2025-04-27 02:45:29,941 - INFO - Compression finished. 2025-04-27 02:45:35,246 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:46:05,285 - INFO - wikitext2 perplexity: 6.93752025-04-27 02:46:05,285 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:46:15,224 - INFO - ptb perplexity: 25.75002025-04-27 02:46:15,224 - INFO - Evaluation results:2025-04-27 02:46:15,224 - INFO -   wikitext2: 6.93752025-04-27 02:46:15,224 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.46it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.48it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.84it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.72it/s]2025-04-27 02:46:17,317 - INFO - Layer: model.layers.8.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:46:17,319 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_8_self_attn_v_proj.safetensors2025-04-27 02:46:17,319 - INFO - exists: True2025-04-27 02:46:17,329 - INFO - factorize_layer_kron_svd2025-04-27 02:46:18,620 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:46:19,872 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 02:46:20,923 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:46:22,086 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:46:23,303 - INFO -   Factor is positive definite (alpha=1.00e-03)model.layers.8.self_attn.v_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_8_self_attn_v_proj.safetensors TrueLayer: model.layers.8.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [7.9353160e-04 6.7463639e-05 1.5334890e-05 1.1648094e-05 1.1388866e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:46:47,354 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:46:47,354 - INFO - Replacing 'model.layers.8.self_attn.v_proj' (attribute 'v_proj' within parent LlamaAttention)2025-04-27 02:46:47,357 - INFO - Compression finished. 2025-04-27 02:46:53,048 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:47:23,495 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:47:23,495 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:47:33,422 - INFO - ptb perplexity: 25.75002025-04-27 02:47:33,422 - INFO - Evaluation results:2025-04-27 02:47:33,422 - INFO -   wikitext2: 7.00002025-04-27 02:47:33,422 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.40it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.49it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.85it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.72it/s]2025-04-27 02:47:35,511 - INFO - Layer: model.layers.8.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:47:35,513 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_8_self_attn_o_proj.safetensors2025-04-27 02:47:35,514 - INFO - exists: True2025-04-27 02:47:35,531 - INFO - factorize_layer_kron_svd2025-04-27 02:47:38,726 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:47:39,887 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:47:41,141 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:47:42,254 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:47:43,522 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.8.self_attn.o_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_8_self_attn_o_proj.safetensors TrueLayer: model.layers.8.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [2.5158012e-03 2.5475896e-05 1.7776394e-05 1.6704555e-05 1.4445048e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:48:12,025 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:48:12,025 - INFO - Replacing 'model.layers.8.self_attn.o_proj' (attribute 'o_proj' within parent LlamaAttention)2025-04-27 02:48:12,028 - INFO - Compression finished. 2025-04-27 02:48:19,113 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:48:49,143 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:48:49,144 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:48:59,075 - INFO - ptb perplexity: 26.25002025-04-27 02:48:59,076 - INFO - Evaluation results:2025-04-27 02:48:59,076 - INFO -   wikitext2: 7.00002025-04-27 02:48:59,076 - INFO -   ptb: 26.2500nlls.shape torch.Size([16376])Mean NLL: 3.265625Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.44it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.59it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.88it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.77it/s]2025-04-27 02:49:01,120 - INFO - Layer: model.layers.8.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:49:01,123 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_8_mlp_gate_proj.safetensors2025-04-27 02:49:01,123 - INFO - exists: True2025-04-27 02:49:01,195 - INFO - factorize_layer_kron_svd2025-04-27 02:49:03,191 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:49:04,361 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:49:05,567 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:49:07,489 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:49:10,639 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.8.mlp.gate_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_8_mlp_gate_proj.safetensors TrueLayer: model.layers.8.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [1.4417933e-03 7.4210926e-05 3.5308200e-05 2.5064986e-05 1.6473876e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 02:49:55,800 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 02:49:55,801 - INFO - Replacing 'model.layers.8.mlp.gate_proj' (attribute 'gate_proj' within parent LlamaMLP)2025-04-27 02:49:55,826 - INFO - Compression finished. 2025-04-27 02:50:01,919 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:50:31,956 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:50:31,956 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:50:41,961 - INFO - ptb perplexity: 25.75002025-04-27 02:50:41,961 - INFO - Evaluation results:2025-04-27 02:50:41,961 - INFO -   wikitext2: 7.00002025-04-27 02:50:41,961 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.53it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.55it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.89it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.78it/s]2025-04-27 02:50:44,074 - INFO - Layer: model.layers.8.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:50:44,076 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_8_mlp_up_proj.safetensors2025-04-27 02:50:44,076 - INFO - exists: True2025-04-27 02:50:44,123 - INFO - factorize_layer_kron_svd2025-04-27 02:50:45,327 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:50:46,378 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:50:47,428 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:50:48,475 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:50:49,523 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:50:50,724 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 02:50:52,324 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:50:54,165 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:50:55,984 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:50:57,763 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:50:59,560 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:51:02,583 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.8.mlp.up_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_8_mlp_up_proj.safetensors TrueLayer: model.layers.8.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [5.3510244e-06 4.6259770e-06 4.5105817e-06 4.3957298e-06 4.3850546e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 02:51:48,115 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 02:51:48,115 - INFO - Replacing 'model.layers.8.mlp.up_proj' (attribute 'up_proj' within parent LlamaMLP)2025-04-27 02:51:48,125 - INFO - Compression finished. 2025-04-27 02:51:55,044 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:52:25,008 - INFO - wikitext2 perplexity: 7.09382025-04-27 02:52:25,008 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9609375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:52:34,923 - INFO - ptb perplexity: 26.62502025-04-27 02:52:34,924 - INFO - Evaluation results:2025-04-27 02:52:34,924 - INFO -   wikitext2: 7.09382025-04-27 02:52:34,924 - INFO -   ptb: 26.6250nlls.shape torch.Size([16376])Mean NLL: 3.28125Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.41it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.48it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.73it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.64it/s]2025-04-27 02:52:37,101 - INFO - Layer: model.layers.8.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:52:37,104 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_8_mlp_down_proj.safetensors2025-04-27 02:52:37,104 - INFO - exists: True2025-04-27 02:52:37,169 - INFO - factorize_layer_kron_svd2025-04-27 02:52:39,759 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:52:43,624 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 02:52:44,662 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:52:45,846 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:52:47,097 - INFO -   Factor is positive definite (alpha=1.00e-03)model.layers.8.mlp.down_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_8_mlp_down_proj.safetensors TrueLayer: model.layers.8.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=11008, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x11008)...  SVD complete. Singular values (top 5): [1.9795836e-03 5.3476641e-04 5.7899004e-05 3.2476404e-05 3.0444553e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,11008), (4096,600)factorized_sequential Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))2025-04-27 02:53:59,252 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))')2025-04-27 02:53:59,253 - INFO - Replacing 'model.layers.8.mlp.down_proj' (attribute 'down_proj' within parent LlamaMLP)2025-04-27 02:53:59,263 - INFO - Compression finished. 2025-04-27 02:54:06,665 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:54:36,518 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:54:36,518 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:54:46,959 - INFO - ptb perplexity: 25.75002025-04-27 02:54:46,959 - INFO - Evaluation results:2025-04-27 02:54:46,959 - INFO -   wikitext2: 7.00002025-04-27 02:54:46,959 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.28it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.49it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.86it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.71it/s]2025-04-27 02:54:49,098 - INFO - Layer: model.layers.9.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:54:49,099 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_9_self_attn_q_proj.safetensors2025-04-27 02:54:49,100 - INFO - exists: True2025-04-27 02:54:49,141 - INFO - factorize_layer_kron_svd2025-04-27 02:54:50,455 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:54:51,701 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 02:54:52,801 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:54:54,031 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.9.self_attn.q_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_9_self_attn_q_proj.safetensors TrueLayer: model.layers.9.self_attn.q_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [3.0099023e-03 2.2926267e-04 3.7865379e-05 2.3257813e-05 1.7436290e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:55:15,484 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:55:15,484 - INFO - Replacing 'model.layers.9.self_attn.q_proj' (attribute 'q_proj' within parent LlamaAttention)2025-04-27 02:55:15,487 - INFO - Compression finished. 2025-04-27 02:55:18,619 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:55:48,773 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:55:48,774 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:55:58,729 - INFO - ptb perplexity: 25.75002025-04-27 02:55:58,729 - INFO - Evaluation results:2025-04-27 02:55:58,729 - INFO -   wikitext2: 7.00002025-04-27 02:55:58,729 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.33it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.53it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.89it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.75it/s]2025-04-27 02:56:00,799 - INFO - Layer: model.layers.9.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:56:00,801 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_9_self_attn_k_proj.safetensors2025-04-27 02:56:00,802 - INFO - exists: True2025-04-27 02:56:00,812 - INFO - factorize_layer_kron_svd2025-04-27 02:56:02,123 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:56:03,325 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:56:04,544 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:56:05,600 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:56:06,766 - INFO -   Factor is positive definite (alpha=1.00e-04)model.layers.9.self_attn.k_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_9_self_attn_k_proj.safetensors TrueLayer: model.layers.9.self_attn.k_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [5.4560183e-03 7.7344026e-05 3.2527361e-05 1.9751154e-05 1.8961458e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:56:27,979 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:56:27,979 - INFO - Replacing 'model.layers.9.self_attn.k_proj' (attribute 'k_proj' within parent LlamaAttention)2025-04-27 02:56:27,982 - INFO - Compression finished. 2025-04-27 02:56:30,198 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:57:00,732 - INFO - wikitext2 perplexity: 7.00002025-04-27 02:57:00,732 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:57:10,885 - INFO - ptb perplexity: 25.75002025-04-27 02:57:10,885 - INFO - Evaluation results:2025-04-27 02:57:10,885 - INFO -   wikitext2: 7.00002025-04-27 02:57:10,885 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.58it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.51it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.80it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.72it/s]2025-04-27 02:57:13,033 - INFO - Layer: model.layers.9.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:57:13,035 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_9_self_attn_v_proj.safetensors2025-04-27 02:57:13,035 - INFO - exists: True2025-04-27 02:57:13,058 - INFO - factorize_layer_kron_svd2025-04-27 02:57:14,334 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:57:15,545 - INFO -   Factor is positive definite (alpha=1.00e-04)2025-04-27 02:57:16,576 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:57:17,700 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:57:18,893 - INFO -   Factor is positive definite (alpha=1.00e-03)model.layers.9.self_attn.v_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_9_self_attn_v_proj.safetensors TrueLayer: model.layers.9.self_attn.v_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Factor is positive definite (alpha=1.00e-04)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [1.6650885e-03 4.7429068e-05 1.5233511e-05 1.3756523e-05 1.1949596e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:57:41,049 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:57:41,050 - INFO - Replacing 'model.layers.9.self_attn.v_proj' (attribute 'v_proj' within parent LlamaAttention)2025-04-27 02:57:41,052 - INFO - Compression finished. 2025-04-27 02:57:43,213 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:58:13,467 - INFO - wikitext2 perplexity: 6.93752025-04-27 02:58:13,467 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:58:23,415 - INFO - ptb perplexity: 26.25002025-04-27 02:58:23,416 - INFO - Evaluation results:2025-04-27 02:58:23,416 - INFO -   wikitext2: 6.93752025-04-27 02:58:23,416 - INFO -   ptb: 26.2500nlls.shape torch.Size([16376])Mean NLL: 3.265625Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.44it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.49it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.88it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.75it/s]2025-04-27 02:58:25,913 - INFO - Layer: model.layers.9.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)2025-04-27 02:58:25,915 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_9_self_attn_o_proj.safetensors2025-04-27 02:58:25,915 - INFO - exists: True2025-04-27 02:58:25,923 - INFO - factorize_layer_kron_svd2025-04-27 02:58:27,140 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:58:28,192 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:58:29,231 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:58:30,271 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:58:31,330 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:58:32,553 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 02:58:33,596 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:58:34,667 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:58:35,721 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 02:58:36,763 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 02:58:37,810 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 02:58:39,045 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.9.self_attn.o_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_9_self_attn_o_proj.safetensors TrueLayer: model.layers.9.self_attn.o_proj | Ratio: 0.200 -> Target Rank: 416 (Align: 8)layer module Linear(in_features=4096, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x4096)...  SVD complete. Singular values (top 5): [5.0775757e-06 2.9041612e-06 2.8834534e-06 2.8196455e-06 2.8097263e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (416,4096), (4096,416)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))2025-04-27 02:59:07,029 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=416, bias=False)  (1): Linear(in_features=416, out_features=4096, bias=False))')2025-04-27 02:59:07,029 - INFO - Replacing 'model.layers.9.self_attn.o_proj' (attribute 'o_proj' within parent LlamaAttention)2025-04-27 02:59:07,032 - INFO - Compression finished. 2025-04-27 02:59:09,641 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:23,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:23<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 02:59:41,484 - INFO - wikitext2 perplexity: 7.06252025-04-27 02:59:41,484 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.953125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.17s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 02:59:51,370 - INFO - ptb perplexity: 27.00002025-04-27 02:59:51,371 - INFO - Evaluation results:2025-04-27 02:59:51,371 - INFO -   wikitext2: 7.06252025-04-27 02:59:51,371 - INFO -   ptb: 27.0000nlls.shape torch.Size([16376])Mean NLL: 3.296875Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.57it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.51it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.77it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.69it/s]2025-04-27 02:59:53,484 - INFO - Layer: model.layers.9.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 02:59:53,485 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_9_mlp_gate_proj.safetensors2025-04-27 02:59:53,485 - INFO - exists: True2025-04-27 02:59:53,529 - INFO - factorize_layer_kron_svd2025-04-27 02:59:55,825 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 02:59:56,988 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 02:59:58,184 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 02:59:59,780 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 03:00:02,502 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 03:00:05,523 - INFO -   Factor is positive definite (alpha=1.00e-03)model.layers.9.mlp.gate_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_9_mlp_gate_proj.safetensors TrueLayer: model.layers.9.mlp.gate_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [1.3037430e-03 4.8500882e-05 8.7262242e-06 6.9377274e-06 6.0911734e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 03:00:51,176 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 03:00:51,176 - INFO - Replacing 'model.layers.9.mlp.gate_proj' (attribute 'gate_proj' within parent LlamaMLP)2025-04-27 03:00:51,185 - INFO - Compression finished. 2025-04-27 03:00:54,052 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 03:01:25,414 - INFO - wikitext2 perplexity: 7.06252025-04-27 03:01:25,414 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.953125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 03:01:35,291 - INFO - ptb perplexity: 25.75002025-04-27 03:01:35,291 - INFO - Evaluation results:2025-04-27 03:01:35,291 - INFO -   wikitext2: 7.06252025-04-27 03:01:35,291 - INFO -   ptb: 25.7500nlls.shape torch.Size([16376])Mean NLL: 3.25Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.49it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.54it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.78it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.70it/s]2025-04-27 03:01:37,405 - INFO - Layer: model.layers.9.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 03:01:37,407 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_9_mlp_up_proj.safetensors2025-04-27 03:01:37,407 - INFO - exists: True2025-04-27 03:01:37,476 - INFO - factorize_layer_kron_svd2025-04-27 03:01:39,347 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 03:01:40,406 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 03:01:41,453 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 03:01:42,506 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 03:01:43,579 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 03:01:44,859 - INFO -   Factor is positive definite (alpha=1.00e+00)2025-04-27 03:01:46,459 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 03:01:48,405 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 03:01:50,272 - INFO -   Regularizing factor (try 3, alpha=1.00e-03)2025-04-27 03:01:52,101 - INFO -   Regularizing factor (try 4, alpha=1.00e-02)2025-04-27 03:01:53,969 - INFO -   Regularizing factor (try 5, alpha=1.00e-01)2025-04-27 03:01:57,690 - INFO -   Factor is positive definite (alpha=1.00e+00)model.layers.9.mlp.up_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_9_mlp_up_proj.safetensors TrueLayer: model.layers.9.mlp.up_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=4096, out_features=11008, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Regularizing factor (try 3, alpha=1.00e-03)  Regularizing factor (try 4, alpha=1.00e-02)  Regularizing factor (try 5, alpha=1.00e-01)  Factor is positive definite (alpha=1.00e+00)  Cholesky decomposition successful.  Performing SVD on transformed matrix (11008x4096)...  SVD complete. Singular values (top 5): [5.3593149e-06 4.8402362e-06 4.7365534e-06 4.6266096e-06 4.5209240e-06]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,4096), (11008,600)factorized_sequential Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))2025-04-27 03:03:00,201 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=4096, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=11008, bias=False))')2025-04-27 03:03:00,201 - INFO - Replacing 'model.layers.9.mlp.up_proj' (attribute 'up_proj' within parent LlamaMLP)2025-04-27 03:03:00,226 - INFO - Compression finished. 2025-04-27 03:03:06,289 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 03:03:36,587 - INFO - wikitext2 perplexity: 7.09382025-04-27 03:03:36,587 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9609375Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 03:03:46,485 - INFO - ptb perplexity: 26.25002025-04-27 03:03:46,485 - INFO - Evaluation results:2025-04-27 03:03:46,485 - INFO -   wikitext2: 7.09382025-04-27 03:03:46,485 - INFO -   ptb: 26.2500nlls.shape torch.Size([16376])Mean NLL: 3.265625Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.34it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.43it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.74it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.63it/s]2025-04-27 03:03:48,675 - INFO - Layer: model.layers.9.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)2025-04-27 03:03:48,676 - INFO - factor_filename: /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_9_mlp_down_proj.safetensors2025-04-27 03:03:48,676 - INFO - exists: True2025-04-27 03:03:48,691 - INFO - factorize_layer_kron_svd2025-04-27 03:03:50,670 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 03:03:53,417 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 03:03:57,046 - INFO -   Factor is positive definite (alpha=1.00e-03)2025-04-27 03:03:58,104 - INFO -   Regularizing factor (try 1, alpha=1.00e-05)2025-04-27 03:03:59,305 - INFO -   Regularizing factor (try 2, alpha=1.00e-04)2025-04-27 03:04:00,687 - INFO -   Factor is positive definite (alpha=1.00e-03)model.layers.9.mlp.down_projfactor_filename /home/jovyan/shares/SR004.nfs2/chekalina/FisherKronecker/grads_output/llama-2-7b-chat/fisher_factors_output_1404/model_layers_9_mlp_down_proj.safetensors TrueLayer: model.layers.9.mlp.down_proj | Ratio: 0.200 -> Target Rank: 600 (Align: 8)layer module Linear(in_features=11008, out_features=4096, bias=False)factorize_layer_kron_svdRegularizing factors for layer (initial alpha=1.00e-05)...  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Regularizing factor (try 1, alpha=1.00e-05)  Regularizing factor (try 2, alpha=1.00e-04)  Factor is positive definite (alpha=1.00e-03)  Cholesky decomposition successful.  Performing SVD on transformed matrix (4096x11008)...  SVD complete. Singular values (top 5): [2.8424084e-02 1.8538581e-04 1.7036285e-04 1.0448481e-04 9.5918804e-05]  Cholesky factor inverses computed.  Factorization complete for layer. New shapes: (600,11008), (4096,600)factorized_sequential Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))2025-04-27 03:05:08,089 - INFO - factorized_sequential 'Sequential(  (0): Linear(in_features=11008, out_features=600, bias=False)  (1): Linear(in_features=600, out_features=4096, bias=False))')2025-04-27 03:05:08,090 - INFO - Replacing 'model.layers.9.mlp.down_proj' (attribute 'down_proj' within parent LlamaMLP)2025-04-27 03:05:08,099 - INFO - Compression finished. 2025-04-27 03:05:14,155 - INFO - Evaluating on wikitext2Evaluating:   0%|                                                  | 0/21 [00:00<?, ?it/s]Evaluating:   5%|██                                        | 1/21 [00:01<00:24,  1.21s/it]Evaluating:  10%|████                                      | 2/21 [00:02<00:22,  1.21s/it]Evaluating:  14%|██████                                    | 3/21 [00:03<00:21,  1.21s/it]Evaluating:  19%|████████                                  | 4/21 [00:04<00:20,  1.21s/it]Evaluating:  24%|██████████                                | 5/21 [00:06<00:19,  1.21s/it]Evaluating:  29%|████████████                              | 6/21 [00:07<00:18,  1.21s/it]Evaluating:  33%|██████████████                            | 7/21 [00:08<00:16,  1.21s/it]Evaluating:  38%|████████████████                          | 8/21 [00:09<00:15,  1.21s/it]Evaluating:  43%|██████████████████                        | 9/21 [00:10<00:14,  1.21s/it]Evaluating:  48%|███████████████████▌                     | 10/21 [00:12<00:13,  1.21s/it]Evaluating:  52%|█████████████████████▍                   | 11/21 [00:13<00:12,  1.21s/it]Evaluating:  57%|███████████████████████▍                 | 12/21 [00:14<00:10,  1.21s/it]Evaluating:  62%|█████████████████████████▍               | 13/21 [00:15<00:09,  1.21s/it]Evaluating:  67%|███████████████████████████▎             | 14/21 [00:16<00:08,  1.21s/it]Evaluating:  71%|█████████████████████████████▎           | 15/21 [00:18<00:07,  1.21s/it]Evaluating:  76%|███████████████████████████████▏         | 16/21 [00:19<00:06,  1.21s/it]Evaluating:  81%|█████████████████████████████████▏       | 17/21 [00:20<00:04,  1.21s/it]Evaluating:  86%|███████████████████████████████████▏     | 18/21 [00:21<00:03,  1.21s/it]Evaluating:  90%|█████████████████████████████████████    | 19/21 [00:22<00:02,  1.21s/it]Evaluating:  95%|███████████████████████████████████████  | 20/21 [00:24<00:01,  1.21s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.13s/it]Evaluating: 100%|█████████████████████████████████████████| 21/21 [00:25<00:00,  1.20s/it]2025-04-27 03:06:07,453 - INFO - wikitext2 perplexity: 7.00002025-04-27 03:06:07,453 - INFO - Evaluating on ptbnlls.shape torch.Size([16376])Mean NLL: 1.9453125Evaluating:   0%|                                                   | 0/7 [00:00<?, ?it/s]Evaluating:  14%|██████▏                                    | 1/7 [00:01<00:07,  1.21s/it]Evaluating:  29%|████████████▎                              | 2/7 [00:02<00:06,  1.21s/it]Evaluating:  43%|██████████████████▍                        | 3/7 [00:03<00:04,  1.21s/it]Evaluating:  57%|████████████████████████▌                  | 4/7 [00:04<00:03,  1.21s/it]Evaluating:  71%|██████████████████████████████▋            | 5/7 [00:06<00:02,  1.21s/it]Evaluating:  86%|████████████████████████████████████▊      | 6/7 [00:07<00:01,  1.21s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.16s/it]Evaluating: 100%|███████████████████████████████████████████| 7/7 [00:08<00:00,  1.19s/it]2025-04-27 03:06:17,555 - INFO - ptb perplexity: 26.25002025-04-27 03:06:17,555 - INFO - Evaluation results:2025-04-27 03:06:17,555 - INFO -   wikitext2: 7.00002025-04-27 03:06:17,555 - INFO -   ptb: 26.2500nlls.shape torch.Size([16376])Mean NLL: 3.265625Loading checkpoint shards:   0%|                                    | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████▎                  | 1/3 [00:00<00:01,  1.17it/s]Loading checkpoint shards:  67%|██████████████████▋         | 2/3 [00:01<00:00,  1.37it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.74it/s]Loading checkpoint shards: 100%|████████████████████████████| 3/3 [00:01<00:00,  1.59it/s]dct{'model.layers.2.self_attn.q_proj': [6.9375, 25.375], 'model.layers.2.self_attn.k_proj': [6.9375, 25.375], 'model.layers.2.self_attn.v_proj': [7.0, 25.375], 'model.layers.2.self_attn.o_proj': [7.0625, 25.75], 'model.layers.2.mlp.gate_proj': [7.0, 28.375], 'model.layers.2.mlp.up_proj': [7.0, 29.25], 'model.layers.2.mlp.down_proj': [7.15625, 28.375], 'model.layers.3.self_attn.q_proj': [6.9375, 25.75], 'model.layers.3.self_attn.k_proj': [6.9375, 25.75], 'model.layers.3.self_attn.v_proj': [7.0, 25.75], 'model.layers.3.self_attn.o_proj': [7.0, 26.625], 'model.layers.3.mlp.gate_proj': [7.0625, 28.75], 'model.layers.3.mlp.up_proj': [7.09375, 28.75], 'model.layers.3.mlp.down_proj': [7.0625, 27.0], 'model.layers.4.self_attn.q_proj': [6.9375, 25.75], 'model.layers.4.self_attn.k_proj': [6.9375, 25.75], 'model.layers.4.self_attn.v_proj': [6.9375, 26.25], 'model.layers.4.self_attn.o_proj': [7.0, 26.25], 'model.layers.4.mlp.gate_proj': [7.0, 26.25], 'model.layers.4.mlp.up_proj': [7.09375, 27.5], 'model.layers.4.mlp.down_proj': [7.0, 27.0], 'model.layers.5.self_attn.q_proj': [7.0, 26.25], 'model.layers.5.self_attn.k_proj': [6.9375, 25.75], 'model.layers.5.self_attn.v_proj': [7.0, 27.0], 'model.layers.5.self_attn.o_proj': [7.0, 26.625], 'model.layers.5.mlp.gate_proj': [7.0625, 26.625], 'model.layers.5.mlp.up_proj': [7.09375, 27.5], 'model.layers.5.mlp.down_proj': [7.0625, 26.625], 'model.layers.6.self_attn.q_proj': [6.9375, 25.75], 'model.layers.6.self_attn.k_proj': [6.9375, 26.25], 'model.layers.6.self_attn.v_proj': [7.0, 26.25], 'model.layers.6.self_attn.o_proj': [7.0625, 26.625], 'model.layers.6.mlp.gate_proj': [7.0625, 27.0], 'model.layers.6.mlp.up_proj': [7.09375, 27.5], 'model.layers.6.mlp.down_proj': [7.0, 26.625], 'model.layers.7.self_attn.q_proj': [6.9375, 25.75], 'model.layers.7.self_attn.k_proj': [6.9375, 25.75], 'model.layers.7.self_attn.v_proj': [7.0, 26.25], 'model.layers.7.self_attn.o_proj': [7.0, 26.625], 'model.layers.7.mlp.gate_proj': [7.0, 26.25], 'model.layers.7.mlp.up_proj': [7.0625, 27.0], 'model.layers.7.mlp.down_proj': [6.9375, 26.25], 'model.layers.8.self_attn.q_proj': [6.9375, 25.75], 'model.layers.8.self_attn.k_proj': [6.9375, 25.75], 'model.layers.8.self_attn.v_proj': [7.0, 25.75], 'model.layers.8.self_attn.o_proj': [7.0, 26.25], 'model.layers.8.mlp.gate_proj': [7.0, 25.75], 'model.layers.8.mlp.up_proj': [7.09375, 26.625], 'model.layers.8.mlp.down_proj': [7.0, 25.75], 'model.layers.9.self_attn.q_proj': [7.0, 25.75], 'model.layers.9.self_attn.k_proj': [7.0, 25.75], 'model.layers.9.self_attn.v_proj': [6.9375, 26.25], 'model.layers.9.self_attn.o_proj': [7.0625, 27.0], 'model.layers.9.mlp.gate_proj': [7.0625, 25.75], 'model.layers.9.mlp.up_proj': [7.09375, 26.25], 'model.layers.9.mlp.down_proj': [7.0, 26.25]}